---
import { Icon } from 'astro-icon/components';
import { SITE } from 'astrowind:config';
import { getHomePermalink } from '~/utils/permalinks';

import { footerData } from '~/navigation';
import { Icon } from 'astro-icon/components';


interface Link {
  text?: string;
  href?: string;
  ariaLabel?: string;
  icon?: string;
}

interface Links {
  title?: string;
  links: Array<Link>;
}

export interface Props {
  links: Array<Links>;
  secondaryLinks: Array<Link>;
  socialLinks: Array<Link>;
  footNote?: string;
  theme?: string;
}

const { socialLinks = [], secondaryLinks = [], links = [], footNote = '', theme = 'light' } = Astro.props;
---

<footer class:list={[{ dark: theme === 'dark' }, 'relative border-t border-gray-200 dark:border-slate-800 not-prose']}>
  <div class="dark:bg-dark absolute inset-0 pointer-events-none" aria-hidden="true"></div>
  <div
    class="relative max-w-7xl mx-auto px-4 sm:px-6 dark:text-slate-300 intersect-once intersect-quarter intersect-no-queue motion-safe:md:opacity-0 motion-safe:md:intersect:animate-fade"
  >
    
    
    <div class="py-6  md:py-8">
      <div class="flex items-center justify-between">
        <!-- Left: Brand -->
        <div class="flex items-center">
          <!-- your existing QYep/logo markup -->
          QYep
        </div>
    
        <!-- Middle: Support / About -->
        <div class="flex items-center gap-10">
          <!-- your existing Support/About links markup -->
          <a class="text-muted hover:underline" href="#">Support</a>
          <a class="text-muted hover:underline" href="#">About</a>
        </div>
    
        <!-- Right: 3 icons -->
        <div class="flex items-center gap-2">
          {footerData?.socialLinks?.map((item) => (
            <div class="relative group">
              {item.href ? (
                <a
                  class="inline-flex h-10 w-10 items-center justify-center rounded-xl border border-white/30 bg-white/40 backdrop-blur-xl
                         hover:bg-white/60 dark:border-white/10 dark:bg-slate-900/40 dark:hover:bg-slate-900/60"
                  aria-label={item.ariaLabel}
                  href={item.href}
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  <Icon name={item.icon} class="h-5 w-5" />
                </a>
              ) : (
                <button
                  type="button"
                  class="inline-flex h-10 w-10 items-center justify-center rounded-xl border border-white/30 bg-white/40 backdrop-blur-xl
                         hover:bg-white/60 dark:border-white/10 dark:bg-slate-900/40 dark:hover:bg-slate-900/60"
                  aria-label={item.ariaLabel}
                >
                  <Icon name={item.icon} class="h-5 w-5" />
                </button>
              )}
    
              <!-- popover (same as yours) -->
              <div
                class="absolute bottom-11 right-0 z-50 w-72 rounded-2xl border border-white/30 bg-white/70 p-4 shadow-lg backdrop-blur-xl
                       invisible opacity-0 translate-y-1 transition
                       group-hover:visible group-hover:opacity-100 group-hover:translate-y-0
                       group-focus-within:visible group-focus-within:opacity-100 group-focus-within:translate-y-0
                       dark:border-white/10 dark:bg-slate-900/70"
              >

                <div class="text-sm font-semibold">{item.ariaLabel}</div>
                {item.label && <div class="mt-2 text-sm opacity-80 break-all">{item.label}</div>}
    
                {item.qrSrc && (
                  <img
                    src={item.qrSrc}
                    alt="QQ QR code"
                    class="mt-3 w-40 rounded-xl border border-white/30 dark:border-white/10"
                  />
                )}
    
                <div class="mt-3 flex flex-wrap gap-2">
                  {item.ariaLabel === 'Email' && item.href && (
                    <a
                      class="rounded-lg border border-white/30 bg-white/40 px-3 py-1 text-sm hover:bg-white/60 dark:border-white/10 dark:bg-slate-900/40 dark:hover:bg-slate-900/60"
                      href={item.href}
                    >
                      Send
                    </a>
                  )}
    
                  {item.copyText && (
                    <button
                      type="button"
                      class="rounded-lg border border-white/30 bg-white/40 px-3 py-1 text-sm hover:bg-white/60 dark:border-white/10 dark:bg-slate-900/40 dark:hover:bg-slate-900/60"
                      data-copy={item.copyText}
                    >
                      Copy
                    </button>
                  )}
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
      
    </div>
        <!-- footnote -->
        <div class="text-sm dark:text-muted mt-6 pb-10">
          <Fragment set:html={footNote} />
        </div>

      </div>
    </div>


  </div>
</footer>

<script>
  document.addEventListener('click', async (e) => {
    const btn = e.target.closest?.('[data-copy]');
    if (!btn) return;

    const text = btn.getAttribute('data-copy');
    if (!text) return;

    try {
      await navigator.clipboard.writeText(text);
      const old = btn.textContent;
      btn.textContent = 'Copied';
      setTimeout(() => (btn.textContent = old), 900);
    } catch {
      // fallback: do nothing
    }
  });
</script>
