---
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('post');

  const slugFrom = (entry) => {
    const s = entry.slug ?? entry.id ?? '';
    return s.replace(/\\/g, '/').split('/').pop().replace(/\.(md|mdx)$/i, '');
  };

  return posts
    .filter((p) => !p.data.draft)
    .map((p) => {
      const slug = slugFrom(p);
      return { params: { slug }, props: { post: p } };
    })
    .filter((x) => x.params.slug);
}

const { post } = Astro.props;
const { Content } = await render(post);
---

<main class="mx-auto max-w-3xl px-4 py-10">
  <a class="underline opacity-80" href="/blog">â† Back</a>

  <h1 class="mt-4 text-3xl font-bold">{post.data.title}</h1>

  <article class="prose mt-8 max-w-none">
    <Content />
  </article>
</main>
