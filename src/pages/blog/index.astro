---
import { getCollection } from 'astro:content';

const toSlug = (entry) => {
  const s = entry.slug ?? entry.id ?? '';
  return s
    .replace(/\\/g, '/')
    .split('/')
    .pop()
    .replace(/\.(md|mdx)$/i, '');
};

const posts = (await getCollection('post'))
  .filter((p) => !p.data.draft)
  .sort((a, b) => {
    const da = a.data.publishDate ? new Date(a.data.publishDate).getTime() : 0;
    const db = b.data.publishDate ? new Date(b.data.publishDate).getTime() : 0;
    return db - da;
  });
---

<main class="mx-auto max-w-3xl px-4 py-10">
  <h1 class="text-3xl font-bold">Blog</h1>

  <ul class="mt-6 space-y-4">
    {
      posts.map((post) => (
        <li>
          <a class="underline" href={`/blog/${toSlug(post)}`}>
            {post.data.title}
          </a>
          {post.data.excerpt && <div class="text-sm opacity-70">{post.data.excerpt}</div>}
        </li>
      ))
    }
  </ul>
</main>
